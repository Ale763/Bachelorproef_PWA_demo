{"remainingRequest":"/Users/ale/Documents/Bachproef/pwa-3/node_modules/babel-loader/lib/index.js!/Users/ale/Documents/Bachproef/pwa-3/node_modules/vuetify-loader/lib/loader.js!/Users/ale/Documents/Bachproef/pwa-3/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/ale/Documents/Bachproef/pwa-3/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/ale/Documents/Bachproef/pwa-3/src/views/Settings.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/ale/Documents/Bachproef/pwa-3/src/views/Settings.vue","mtime":1560603414420},{"path":"/Users/ale/Documents/Bachproef/pwa-3/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/ale/Documents/Bachproef/pwa-3/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/ale/Documents/Bachproef/pwa-3/node_modules/vuetify-loader/lib/loader.js","mtime":1549812933000},{"path":"/Users/ale/Documents/Bachproef/pwa-3/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/ale/Documents/Bachproef/pwa-3/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.regexp.split\";\nimport _getIterator from \"/Users/ale/Documents/Bachproef/pwa-3/node_modules/@babel/runtime-corejs2/core-js/get-iterator\";\nimport _JSON$stringify from \"/Users/ale/Documents/Bachproef/pwa-3/node_modules/@babel/runtime-corejs2/core-js/json/stringify\";\nimport \"core-js/modules/es6.function.name\";\nimport \"regenerator-runtime/runtime\";\nimport _asyncToGenerator from \"/Users/ale/Documents/Bachproef/pwa-3/node_modules/@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport localForage from \"localforage\";\nimport * as firebase from \"firebase/app\";\nimport \"firebase/messaging\";\nexport default {\n  name: 'Settings',\n  data: function data() {\n    return {\n      strategy: \"none\",\n      usergroup: \"none\",\n      notificationConfig: \"default\",\n      flag: false,\n      sw: null,\n      registration: null,\n      firebase: {\n        config: {\n          apiKey: \"AIzaSyAyGInviSJMCyZV_XHLIRa8fKAt-wsaAJA\",\n          authDomain: \"pwademo-763.firebaseapp.com\",\n          databaseURL: \"https://pwademo-763.firebaseio.com\",\n          projectId: \"pwademo-763\",\n          storageBucket: \"pwademo-763.appspot.com\",\n          messagingSenderId: \"857384407396\"\n        },\n        messaging: null,\n        token: null\n      },\n      showNotificationPrompt: Notification.permission !== 'granted',\n      notificationSubscribed: false,\n      pwa: {\n        installed: false,\n        showInstallButton: false,\n        promptEvent: null\n      }\n    };\n  },\n  created: function () {\n    var _created = _asyncToGenerator(\n    /*#__PURE__*/\n    regeneratorRuntime.mark(function _callee2() {\n      var _this = this;\n\n      var THIS;\n      return regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              this.pageTitle = this.$route.name;\n              localForage.setDriver([localForage.INDEXEDDB, localForage.WEBSQL, localForage.LOCALSTORAGE]).then(function () {\n                localForage.config({\n                  name: \"Alessio\",\n                  version: 1.0,\n                  size: 4980736,\n                  // Size of database, in bytes. WebSQL-only for now.\n                  storeName: \"lf2\",\n                  // Should be alphanumeric, with underscores.\n                  description: \"some description\"\n                });\n              });\n              this.lf = localForage.createInstance({\n                name: \"lf\"\n              });\n              window.addEventListener(\"change\", function (event) {\n                console.log(\"productCachePolicy: \", event);\n              });\n              window.addEventListener('load',\n              /*#__PURE__*/\n              _asyncToGenerator(\n              /*#__PURE__*/\n              regeneratorRuntime.mark(function _callee() {\n                return regeneratorRuntime.wrap(function _callee$(_context) {\n                  while (1) {\n                    switch (_context.prev = _context.next) {\n                      case 0:\n                        _context.next = 2;\n                        return navigator.serviceWorker.register(\"/sw.js\").then(function (reg) {\n                          _this.flag = true;\n                          _this.sw = reg.active;\n                          return reg;\n                        }).catch(function (error) {\n                          return console.error(\"registration failed: \", error);\n                        });\n\n                      case 2:\n                        _this.registration = _context.sent;\n\n                      case 3:\n                      case \"end\":\n                        return _context.stop();\n                    }\n                  }\n                }, _callee);\n              })));\n              this.initStrategy();\n              this.initUsergroupCookie();\n              this.initNotificationConfigCookie();\n              this.firebaseNotificationsHandler();\n              THIS = this;\n              window.addEventListener(\"beforeinstallprompt\", function (e) {\n                // Prevent Chrome 67 and earlier from automatically showing the prompt\n                e.preventDefault(); // Stash the event so it can be triggered later.\n\n                THIS.pwa.promptEvent = e;\n                THIS.pwa.showInstallButton = true;\n              });\n              window.addEventListener('appinstalled', function (evt) {\n                _this.pwa.installed = true;\n                console.log('üëç', 'appinstalled', event);\n                _this.showNotificationPrompt = true;\n              });\n\n            case 12:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2, this);\n    }));\n\n    function created() {\n      return _created.apply(this, arguments);\n    }\n\n    return created;\n  }(),\n  methods: {\n    installPWA: function installPWA() {\n      this.pwa.promptEvent.prompt();\n    },\n    sendPost: function () {\n      var _sendPost = _asyncToGenerator(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee3(url) {\n        var rawResponse;\n        return regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                _context3.next = 2;\n                return fetch(url, {\n                  method: 'POST',\n                  credentials: 'omit'\n                });\n\n              case 2:\n                rawResponse = _context3.sent;\n\n              case 3:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3);\n      }));\n\n      function sendPost(_x) {\n        return _sendPost.apply(this, arguments);\n      }\n\n      return sendPost;\n    }(),\n    sendToken: function () {\n      var _sendToken = _asyncToGenerator(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee4(token) {\n        var rawResponse;\n        return regeneratorRuntime.wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                _context4.next = 2;\n                return fetch('/api/save_token/', {\n                  method: 'POST',\n                  credentials: 'omit',\n                  headers: {\n                    'Accept': 'application/json',\n                    'Content-Type': 'application/json'\n                  },\n                  body: _JSON$stringify({\n                    \"token\": token\n                  })\n                });\n\n              case 2:\n                rawResponse = _context4.sent;\n\n              case 3:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4);\n      }));\n\n      function sendToken(_x2) {\n        return _sendToken.apply(this, arguments);\n      }\n\n      return sendToken;\n    }(),\n    sendMode: function () {\n      var _sendMode = _asyncToGenerator(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee5(mode) {\n        var rawResponse;\n        return regeneratorRuntime.wrap(function _callee5$(_context5) {\n          while (1) {\n            switch (_context5.prev = _context5.next) {\n              case 0:\n                _context5.next = 2;\n                return fetch('/api/set_mode/', {\n                  method: 'POST',\n                  credentials: 'omit',\n                  headers: {\n                    'Accept': 'application/json',\n                    'Content-Type': 'application/json'\n                  },\n                  body: _JSON$stringify({\n                    \"mode\": mode\n                  })\n                });\n\n              case 2:\n                rawResponse = _context5.sent;\n\n              case 3:\n              case \"end\":\n                return _context5.stop();\n            }\n          }\n        }, _callee5);\n      }));\n\n      function sendMode(_x3) {\n        return _sendMode.apply(this, arguments);\n      }\n\n      return sendMode;\n    }(),\n    setStrategy: function () {\n      var _setStrategy = _asyncToGenerator(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee6() {\n        return regeneratorRuntime.wrap(function _callee6$(_context6) {\n          while (1) {\n            switch (_context6.prev = _context6.next) {\n              case 0:\n                this.registration.active.postMessage({\n                  action: 'updateProductCachePolicy',\n                  policy: this.strategy\n                });\n\n              case 1:\n              case \"end\":\n                return _context6.stop();\n            }\n          }\n        }, _callee6, this);\n      }));\n\n      function setStrategy() {\n        return _setStrategy.apply(this, arguments);\n      }\n\n      return setStrategy;\n    }(),\n    setUserCookie: function () {\n      var _setUserCookie = _asyncToGenerator(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee7() {\n        return regeneratorRuntime.wrap(function _callee7$(_context7) {\n          while (1) {\n            switch (_context7.prev = _context7.next) {\n              case 0:\n                if (this.usergroup === '1' || this.usergroup === '2') {\n                  this._setCookie(\"User\", this.usergroup);\n                } else {\n                  this._deteleCookie(\"User\");\n                }\n\n              case 1:\n              case \"end\":\n                return _context7.stop();\n            }\n          }\n        }, _callee7, this);\n      }));\n\n      function setUserCookie() {\n        return _setUserCookie.apply(this, arguments);\n      }\n\n      return setUserCookie;\n    }(),\n    setNotificationConfigCookie: function () {\n      var _setNotificationConfigCookie = _asyncToGenerator(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee8() {\n        return regeneratorRuntime.wrap(function _callee8$(_context8) {\n          while (1) {\n            switch (_context8.prev = _context8.next) {\n              case 0:\n                if (this.notificationConfig === 'only_orders' || this.notificationConfig === 'none') {\n                  this._setCookie(\"notificationConfig\", this.notificationConfig);\n                } else {\n                  this.notificationConfig = \"default\";\n\n                  this._setCookie(\"notificationConfig\", this.notificationConfig);\n                }\n\n                this.sendMode(this.notificationConfig);\n\n              case 2:\n              case \"end\":\n                return _context8.stop();\n            }\n          }\n        }, _callee8, this);\n      }));\n\n      function setNotificationConfigCookie() {\n        return _setNotificationConfigCookie.apply(this, arguments);\n      }\n\n      return setNotificationConfigCookie;\n    }(),\n    initStrategy: function () {\n      var _initStrategy = _asyncToGenerator(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee9() {\n        var response, productCachePolicy;\n        return regeneratorRuntime.wrap(function _callee9$(_context9) {\n          while (1) {\n            switch (_context9.prev = _context9.next) {\n              case 0:\n                _context9.next = 2;\n                return fetch(\"/sw/productCachePolicy\").catch(function (err) {\n                  return null;\n                });\n\n              case 2:\n                response = _context9.sent;\n                productCachePolicy = \"none\";\n\n                if (!(response != null)) {\n                  _context9.next = 8;\n                  break;\n                }\n\n                _context9.next = 7;\n                return response.json().then(function (data) {\n                  return data.policy;\n                }).catch(function (err) {\n                  return \"none\";\n                });\n\n              case 7:\n                productCachePolicy = _context9.sent;\n\n              case 8:\n                this.strategy = productCachePolicy;\n\n              case 9:\n              case \"end\":\n                return _context9.stop();\n            }\n          }\n        }, _callee9, this);\n      }));\n\n      function initStrategy() {\n        return _initStrategy.apply(this, arguments);\n      }\n\n      return initStrategy;\n    }(),\n    initUsergroupCookie: function initUsergroupCookie() {\n      var usergroupCookie = this._getCookieValue('User');\n\n      if (usergroupCookie) this.usergroup = usergroupCookie;else this.usergroup = \"none\";\n    },\n    initNotificationConfigCookie: function initNotificationConfigCookie() {\n      var notificationConfigCookie = this._getCookieValue('notificationConfig');\n\n      if (notificationConfigCookie = null) notificationConfigCookie = 'default';\n      this.notificationConfig = notificationConfigCookie;\n      this.setNotificationConfigCookie();\n\n      var subscribed = this._getCookieValue(\"notificationSubscribed\");\n\n      if (subscribed == null) subscribed = false;\n      this.notificationSubscribed = Notification.permission === 'granted';\n\n      if (window.matchMedia('(display-mode: standalone)').matches) {\n        this.pwa.installed = true;\n      }\n\n      this.showNotificationPrompt = Notification.permission !== 'granted' && this.pwa.installed;\n    },\n    _getStrategy: function () {\n      var _getStrategy2 = _asyncToGenerator(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee10() {\n        var response, productCachePolicy;\n        return regeneratorRuntime.wrap(function _callee10$(_context10) {\n          while (1) {\n            switch (_context10.prev = _context10.next) {\n              case 0:\n                if (!this.registration.active) {\n                  _context10.next = 10;\n                  break;\n                }\n\n                _context10.next = 3;\n                return fetch(\"/sw/productCachePolicy\").catch(function (err) {\n                  return null;\n                });\n\n              case 3:\n                response = _context10.sent;\n                productCachePolicy = \"none\";\n\n                if (!(response != null)) {\n                  _context10.next = 9;\n                  break;\n                }\n\n                _context10.next = 8;\n                return response.json().then(function (data) {\n                  return data.policy;\n                }).catch(function (err) {\n                  return \"none\";\n                });\n\n              case 8:\n                productCachePolicy = _context10.sent;\n\n              case 9:\n                return _context10.abrupt(\"return\", productCachePolicy);\n\n              case 10:\n                return _context10.abrupt(\"return\", \"none\");\n\n              case 11:\n              case \"end\":\n                return _context10.stop();\n            }\n          }\n        }, _callee10, this);\n      }));\n\n      function _getStrategy() {\n        return _getStrategy2.apply(this, arguments);\n      }\n\n      return _getStrategy;\n    }(),\n    _setCookie: function _setCookie(key, value) {\n      var parsedCookies = this._parseDocumentCookies();\n\n      parsedCookies = this._setValueOnParsedCookies(parsedCookies, key, value);\n\n      var stringifiedCookies = this._stringifyParsedCookies(parsedCookies);\n\n      var cookie = \"\".concat(key, \"=\").concat(value);\n      document.cookie = cookie;\n      if (key !== \"User\") return;\n\n      if (this.registration.active) {\n        this.registration.active.postMessage({\n          action: 'setUserCookie',\n          cookies: cookie\n        });\n      }\n    },\n    _getCookieValue: function _getCookieValue(key) {\n      var parsedCookies = this._parseDocumentCookies();\n\n      var _iteratorNormalCompletion = true;\n      var _didIteratorError = false;\n      var _iteratorError = undefined;\n\n      try {\n        for (var _iterator = _getIterator(parsedCookies), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n          var cookie = _step.value;\n          if (cookie[0] === key) return cookie[1];\n        }\n      } catch (err) {\n        _didIteratorError = true;\n        _iteratorError = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion && _iterator.return != null) {\n            _iterator.return();\n          }\n        } finally {\n          if (_didIteratorError) {\n            throw _iteratorError;\n          }\n        }\n      }\n\n      return null;\n    },\n    _deteleCookie: function _deteleCookie(key) {\n      document.cookie = \"\".concat(key, \"= ; expires = Thu, 01 Jan 1970 00:00:00 GMT\");\n    },\n    _parseDocumentCookies: function _parseDocumentCookies() {\n      var docCookies = document.cookie;\n      if (docCookies === \"\") return [];\n      docCookies = docCookies.split('; ');\n      var parsedCookies = [];\n      var _iteratorNormalCompletion2 = true;\n      var _didIteratorError2 = false;\n      var _iteratorError2 = undefined;\n\n      try {\n        for (var _iterator2 = _getIterator(docCookies), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {\n          var docCookie = _step2.value;\n          var parsedCookie = docCookie.split('=');\n          parsedCookies.push(parsedCookie);\n        }\n      } catch (err) {\n        _didIteratorError2 = true;\n        _iteratorError2 = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion2 && _iterator2.return != null) {\n            _iterator2.return();\n          }\n        } finally {\n          if (_didIteratorError2) {\n            throw _iteratorError2;\n          }\n        }\n      }\n\n      return parsedCookies;\n    },\n    _setValueOnParsedCookies: function _setValueOnParsedCookies(parsedCookies, key, value) {\n      var valueSet = false;\n\n      for (var i = 0; i < parsedCookies.length; ++i) {\n        if (parsedCookies[i][0] === key) {\n          parsedCookies[i][1] = value;\n          valueSet = true;\n        }\n      }\n\n      if (!valueSet) parsedCookies.push([key, value]);\n      return parsedCookies;\n    },\n    _stringifyParsedCookies: function _stringifyParsedCookies(parsedCookies) {\n      var stringifiedCookies = \"\";\n      var _iteratorNormalCompletion3 = true;\n      var _didIteratorError3 = false;\n      var _iteratorError3 = undefined;\n\n      try {\n        for (var _iterator3 = _getIterator(parsedCookies), _step3; !(_iteratorNormalCompletion3 = (_step3 = _iterator3.next()).done); _iteratorNormalCompletion3 = true) {\n          var cookie = _step3.value;\n          stringifiedCookies += \"\".concat(cookie[0], \"=\").concat(cookie[1], \";\");\n        }\n      } catch (err) {\n        _didIteratorError3 = true;\n        _iteratorError3 = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion3 && _iterator3.return != null) {\n            _iterator3.return();\n          }\n        } finally {\n          if (_didIteratorError3) {\n            throw _iteratorError3;\n          }\n        }\n      }\n\n      return stringifiedCookies;\n    },\n    _firebaseInit: function _firebaseInit() {\n      firebase.initializeApp(this.firebase.config);\n      this.firebase.messaging = firebase.messaging();\n      this.firebase.messaging.usePublicVapidKey(\"BHEX_KV05JO3refzgJbNXaXObnSiCb2kjx1rOsLWhMon4dea2ddfiYD0iLBHm6DsQkVp8sCLr2Ypuuz6haDnOzo\");\n\n      this._firebaseGetToken();\n    },\n    _firebaseGetToken: function _firebaseGetToken() {\n      var THIS = this;\n      return THIS.firebase.messaging.getToken().then(function (currentToken) {\n        if (currentToken) {\n          THIS.firebase.token = currentToken;\n          THIS.notificationSubscribed = true;\n          THIS.sendToken(currentToken);\n          THIS.showNotificationPrompt = false;\n\n          THIS._setCookie(\"notificationSubscribed\", \"true\");\n        } else {\n          console.log(\"No Instance ID token available. Request permission to generate one.\");\n        }\n      }).catch(function (err) {\n        console.log(\"An error occurred while retrieving token. \", err);\n      });\n    },\n    _firebaseRequestPermission: function _firebaseRequestPermission() {\n      var _this2 = this;\n\n      var THIS = this;\n      this.firebase.messaging.requestPermission().then(function () {\n        // console.log('Notification permission granted.');\n        _this2._firebaseGetToken().then(function (response) {\n          var notificationConfigCookie = THIS._getCookieValue('notificationConfig');\n\n          if (notificationConfigCookie) THIS.notificationConfig = notificationConfigCookie;else THIS.notificationConfig = \"default\"; // let payload = {\n          //     \t   \"to\": THIS.firebase.token,\n          //         \"collapse_key\": \"type_a\",\n          //         \"notification\":\n          //         {\n          //             \"title\": \"payload.title\",\n          //             \"body\": \"payload.body\",\n          //             \"icon\": \"payload.icon\",\n          //             \"click_action\": \"payload.action\"\n          //         },\n          //         \"data\":\n          //         {\n          //             \"shown\": false\n          //         }\n          // };\n          // FirebaseService.sendNotificationToSelf(payload)\n        });\n      }).catch(function (err) {\n        console.log(\"Unable to get permission to notify.\", err);\n      });\n    },\n    firebaseNotificationsHandler: function firebaseNotificationsHandler() {\n      var _this3 = this;\n\n      var THIS = this;\n\n      this._firebaseInit(); // this._firebaseRequestPermission();\n      // -----------------------------------------------------------------------------------------------------\n      // Event listeners\n\n\n      THIS.firebase.messaging.onTokenRefresh(function () {\n        _this3._firebaseGetToken();\n\n        console.log(\"TOKEN REFRESHED: \", THIS.firebase.token);\n      });\n      THIS.firebase.messaging.onMessage(function (payload) {\n        console.log(\"Message received. \", payload);\n\n        if (Notification.permission === \"granted\") {\n          var notification = new Notification(payload.notification.title, {\n            icon: payload.notification.icon,\n            body: payload.notification.body\n          });\n\n          notification.onclick = function () {\n            console.log(\"NOTIFCATION CLICK\");\n            window.open(payload.notification.click_action, \"_blank\");\n          };\n\n          return notification;\n        }\n      });\n    }\n  }\n};",{"version":3,"sources":["Settings.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n<div class=\"settings\">\n    <v-card v-if=\"flag\">\n        <v-card-text>\n            <div v-if=\"!notificationSubscribed\">\n                <v-btn color=\"\" @click=\"showNotificationPrompt = true\">\n                    <v-icon>notifications</v-icon>Subscribe to notifications\n                </v-btn>\n            </div>\n            <div v-if=\"pwa.showInstallButton\">\n                <v-btn color=\"\" @click=\"installPWA()\">\n                    <v-icon>get_app</v-icon>Install PWA\n                </v-btn>\n            </div>\n            <v-container fluid>\n                <v-layout column wrap>\n                    <v-flex xs12>\n                        <h2>Set cache strategy</h2>\n                    </v-flex>\n                    <v-flex xs12>\n                        <v-radio-group v-model=\"strategy\" :mandatory=\"false\" @change=\"setStrategy\">\n                            <v-radio label=\"None\" value=\"none\"></v-radio>\n                            <v-radio label=\"History\" value=\"history\"></v-radio>\n                            <v-radio label=\"Predictive\" value=\"predictive\"></v-radio>\n                        </v-radio-group>\n                    </v-flex>\n                </v-layout>\n            </v-container>\n            <v-container fluid>\n                <v-layout row wrap>\n                    <v-flex xs12>\n                        <h2>Set user group</h2>\n                    </v-flex>\n                    <v-flex xs12>\n                        <v-radio-group v-model=\"usergroup\" :mandatory=\"false\" @change=\"setUserCookie\">\n                            <v-radio label=\"Anonymous\" value=\"none\"></v-radio>\n                            <v-radio label=\"User 1\" value=\"1\"></v-radio>\n                            <v-radio label=\"User 2\" value=\"2\"></v-radio>\n                        </v-radio-group>\n                    </v-flex>\n                </v-layout>\n            </v-container>\n            <v-container fluid v-if=\"notificationSubscribed\">\n                <v-layout row wrap>\n                    <v-flex xs10>\n                        <h2>Configure notifications</h2>\n                    </v-flex>\n\n                    <v-flex xs12>\n                        <v-radio-group v-model=\"notificationConfig\" :mandatory=\"false\" @change=\"setNotificationConfigCookie\">\n                            <v-radio label=\"Default\" value=\"default\"></v-radio>\n                            <v-radio label=\"Only orders\" value=\"only_orders\"></v-radio>\n                            <v-radio label=\"None\" value=\"none\"></v-radio>\n                        </v-radio-group>\n                        <v-item-group multiple style=\"text-align:center;\">\n                            <h3>Send notifications</h3>\n                            <v-item>\n                                <v-btn color=\"info\" @click=\"sendPost('/api/send_order_notification/')\">Order</v-btn>\n                            </v-item>\n                            <v-item>\n                                <v-btn color=\"info\" @click=\"sendPost('/api/send_promo_notification/')\">Promo</v-btn>\n                            </v-item>\n                            <v-item>\n                                <v-btn color=\"info\" @click=\"sendPost('/api/send_promo_notification2/')\">Promo 2</v-btn>\n                            </v-item>\n                        </v-item-group>\n                    </v-flex>\n                </v-layout>\n            </v-container>\n\n            <v-snackbar v-model=\"showNotificationPrompt\" :timeout=\"0\" :vertical=\"true\">\n                Do you want to subscribe to push notifications to stay up to date?\n                <v-item-group multiple style=\"text-align:center;\">\n                    <v-item>\n                        <v-btn style=\"padding: 5px 10px;margin-top: 0;margin-right: 40px;\" color=\"info\" @click=\"_firebaseRequestPermission()\">Yes</v-btn>\n                    </v-item>\n                    <v-item>\n                        <v-btn style=\"padding: 5px 10px;margin-top: 0;margin-left: 40px;\" color=\"info\" @click=\"showNotificationPrompt = false\">No</v-btn>\n                    </v-item>\n                </v-item-group>\n            </v-snackbar>\n        </v-card-text>\n    </v-card>\n</div>\n</template>\n\n<script>\nimport localForage from \"localforage\";\nimport * as firebase from \"firebase/app\";\nimport \"firebase/messaging\";\nexport default\n{\n    name: 'Settings',\n    data()\n    {\n        return {\n            strategy: \"none\",\n            usergroup: \"none\",\n            notificationConfig: \"default\",\n            flag: false,\n            sw: null,\n            registration: null,\n            firebase:\n            {\n                config:\n                {\n                    apiKey: \"AIzaSyAyGInviSJMCyZV_XHLIRa8fKAt-wsaAJA\",\n                    authDomain: \"pwademo-763.firebaseapp.com\",\n                    databaseURL: \"https://pwademo-763.firebaseio.com\",\n                    projectId: \"pwademo-763\",\n                    storageBucket: \"pwademo-763.appspot.com\",\n                    messagingSenderId: \"857384407396\"\n                },\n                messaging: null,\n                token: null\n            },\n            showNotificationPrompt: Notification.permission !== 'granted',\n            notificationSubscribed: false,\n            pwa:\n            {\n                installed: false,\n                showInstallButton: false,\n                promptEvent: null\n\n            }\n        }\n    },\n    async created()\n    {\n        this.pageTitle = this.$route.name;\n        localForage\n            .setDriver([\n                localForage.INDEXEDDB,\n                localForage.WEBSQL,\n                localForage.LOCALSTORAGE\n            ])\n            .then(function ()\n            {\n                localForage.config(\n                {\n                    name: \"Alessio\",\n                    version: 1.0,\n                    size: 4980736, // Size of database, in bytes. WebSQL-only for now.\n                    storeName: \"lf2\", // Should be alphanumeric, with underscores.\n                    description: \"some description\"\n                });\n            });\n\n        this.lf = localForage.createInstance(\n        {\n            name: \"lf\"\n        });\n\n        window.addEventListener(\"change\", (event) =>\n        {\n            console.log(\"productCachePolicy: \", event);\n        });\n\n        window.addEventListener('load', async () =>\n        {\n            this.registration = await navigator.serviceWorker.register(\"/sw.js\")\n                .then(reg =>\n                {\n                    this.flag = true;\n                    this.sw = reg.active;\n                    return reg;\n                })\n                .catch((error) => console.error(`registration failed: `, error));\n        });\n        this.initStrategy();\n        this.initUsergroupCookie();\n        this.initNotificationConfigCookie();\n        this.firebaseNotificationsHandler();\n\n        let THIS = this;\n        window.addEventListener(\"beforeinstallprompt\", function (e)\n        {\n            // Prevent Chrome 67 and earlier from automatically showing the prompt\n            e.preventDefault();\n            // Stash the event so it can be triggered later.\n            THIS.pwa.promptEvent = e;\n\n            THIS.pwa.showInstallButton = true;\n        });\n\n        window.addEventListener('appinstalled', (evt) =>\n        {\n            this.pwa.installed = true;\n            console.log('üëç', 'appinstalled', event);\n            this.showNotificationPrompt = true;\n        });\n    },\n    methods:\n    {\n        installPWA()\n        {\n            this.pwa.promptEvent.prompt();\n        },\n        async sendPost(url)\n        {\n            const rawResponse = await fetch(url,\n            {\n                method: 'POST',\n                credentials: 'omit',\n            });\n        },\n        async sendToken(token)\n        {\n            const rawResponse = await fetch('/api/save_token/',\n            {\n                method: 'POST',\n                credentials: 'omit',\n                headers:\n                {\n                    'Accept': 'application/json',\n                    'Content-Type': 'application/json'\n                },\n                body: JSON.stringify(\n                {\n                    \"token\": token\n                })\n            });\n        },\n        async sendMode(mode)\n        {\n            const rawResponse = await fetch('/api/set_mode/',\n            {\n                method: 'POST',\n                credentials: 'omit',\n                headers:\n                {\n                    'Accept': 'application/json',\n                    'Content-Type': 'application/json'\n                },\n                body: JSON.stringify(\n                {\n                    \"mode\": mode\n                })\n            });\n            // const content = await rawResponse.json();\n        },\n        async setStrategy()\n        {\n            this.registration.active.postMessage(\n            {\n                action: 'updateProductCachePolicy',\n                policy: this.strategy\n            });\n        },\n        async setUserCookie()\n        {\n            if (this.usergroup === '1' || this.usergroup === '2')\n            {\n                this._setCookie(\"User\", this.usergroup);\n            }\n            else\n            {\n                this._deteleCookie(\"User\");\n            }\n        },\n        async setNotificationConfigCookie()\n        {\n            if (this.notificationConfig === 'only_orders' || this.notificationConfig === 'none')\n            {\n                this._setCookie(\"notificationConfig\", this.notificationConfig);\n            }\n            else\n            {\n                this.notificationConfig = \"default\"\n                this._setCookie(\"notificationConfig\", this.notificationConfig);\n            }\n            this.sendMode(this.notificationConfig)\n        },\n        async initStrategy()\n        {\n            let response = await fetch(\"/sw/productCachePolicy\").catch(err =>\n            {\n                return null;\n            });\n            let productCachePolicy = \"none\";\n            if (response != null)\n                productCachePolicy = await response.json().then(data =>\n                {\n                    return data.policy;\n                }).catch(err =>\n                {\n                    return \"none\";\n                });\n            this.strategy = productCachePolicy;\n\n        },\n        initUsergroupCookie()\n        {\n            let usergroupCookie = this._getCookieValue('User');\n            if (usergroupCookie)\n                this.usergroup = usergroupCookie;\n            else\n                this.usergroup = \"none\"\n        },\n        initNotificationConfigCookie()\n        {\n            let notificationConfigCookie = this._getCookieValue('notificationConfig');\n            if (notificationConfigCookie = null) notificationConfigCookie = 'default';\n\n\n            this.notificationConfig = notificationConfigCookie;\n\n            this.setNotificationConfigCookie()\n\n            let subscribed = this._getCookieValue(\"notificationSubscribed\");\n            if (subscribed == null) subscribed = false;\n            this.notificationSubscribed = (Notification.permission === 'granted');\n            if (window.matchMedia('(display-mode: standalone)').matches)\n            {\n                this.pwa.installed = true;\n            }\n            this.showNotificationPrompt = Notification.permission !== 'granted' && this.pwa.installed;\n        },\n        async _getStrategy()\n        {\n            if (this.registration.active)\n            {\n                let response = await fetch(\"/sw/productCachePolicy\").catch(err =>\n                {\n                    return null;\n                });\n                let productCachePolicy = \"none\";\n                if (response != null)\n                    productCachePolicy = await response.json().then(data =>\n                    {\n                        return data.policy;\n                    }).catch(err =>\n                    {\n                        return \"none\";\n                    });\n                return productCachePolicy;\n            }\n            return \"none\";\n        },\n        _setCookie(key, value)\n        {\n            let parsedCookies = this._parseDocumentCookies();\n            parsedCookies = this._setValueOnParsedCookies(parsedCookies, key, value);\n            let stringifiedCookies = this._stringifyParsedCookies(parsedCookies);\n            let cookie = `${key}=${value}`\n            document.cookie = cookie;\n\n            if (key !== \"User\")\n                return\n            if (this.registration.active)\n            {\n                this.registration.active.postMessage(\n                {\n                    action: 'setUserCookie',\n                    cookies: cookie\n                });\n            }\n        },\n        _getCookieValue(key)\n        {\n            let parsedCookies = this._parseDocumentCookies();\n            for (let cookie of parsedCookies)\n            {\n                if (cookie[0] === key)\n                    return cookie[1];\n            }\n            return null\n        },\n        _deteleCookie(key)\n        {\n            document.cookie = `${key}= ; expires = Thu, 01 Jan 1970 00:00:00 GMT`\n        },\n        _parseDocumentCookies()\n        {\n            let docCookies = document.cookie;\n            if (docCookies === \"\")\n                return []\n            docCookies = docCookies.split('; ');\n            let parsedCookies = [];\n            for (let docCookie of docCookies)\n            {\n                let parsedCookie = docCookie.split('=');\n                parsedCookies.push(parsedCookie);\n            }\n            return parsedCookies;\n        },\n        _setValueOnParsedCookies(parsedCookies, key, value)\n        {\n            let valueSet = false;\n            for (let i = 0; i < parsedCookies.length; ++i)\n            {\n                if (parsedCookies[i][0] === key)\n                {\n                    parsedCookies[i][1] = value\n                    valueSet = true;\n                }\n            }\n            if (!valueSet)\n                parsedCookies.push([key, value]);\n            return parsedCookies;\n        },\n        _stringifyParsedCookies(parsedCookies)\n        {\n            let stringifiedCookies = \"\";\n            for (let cookie of parsedCookies)\n            {\n                stringifiedCookies += `${cookie[0]}=${cookie[1]};`;\n            }\n            return stringifiedCookies;\n        },\n        _firebaseInit()\n        {\n            firebase.initializeApp(this.firebase.config);\n            this.firebase.messaging = firebase.messaging();\n            this.firebase.messaging.usePublicVapidKey(\n                \"BHEX_KV05JO3refzgJbNXaXObnSiCb2kjx1rOsLWhMon4dea2ddfiYD0iLBHm6DsQkVp8sCLr2Ypuuz6haDnOzo\"\n            );\n            this._firebaseGetToken();\n        },\n        _firebaseGetToken()\n        {\n            const THIS = this;\n            return THIS.firebase.messaging\n                .getToken()\n                .then(function (currentToken)\n                {\n                    if (currentToken)\n                    {\n                        THIS.firebase.token = currentToken;\n                        THIS.notificationSubscribed = true;\n                        THIS.sendToken(currentToken)\n                        THIS.showNotificationPrompt = false\n                        THIS._setCookie(\"notificationSubscribed\", \"true\")\n                    }\n                    else\n                    {\n                        console.log(\n                            \"No Instance ID token available. Request permission to generate one.\"\n                        );\n                    }\n                })\n                .catch(function (err)\n                {\n                    console.log(\"An error occurred while retrieving token. \", err);\n                });\n        },\n        _firebaseRequestPermission()\n        {\n            const THIS = this;\n            this.firebase.messaging\n                .requestPermission()\n                .then(() =>\n                {\n                    // console.log('Notification permission granted.');\n                    this._firebaseGetToken().then(response =>\n                    {\n                        let notificationConfigCookie = THIS._getCookieValue('notificationConfig');\n                        if (notificationConfigCookie)\n                            THIS.notificationConfig = notificationConfigCookie;\n                        else\n                            THIS.notificationConfig = \"default\"\n                        // let payload = {\n                        //     \t   \"to\": THIS.firebase.token,\n                        //         \"collapse_key\": \"type_a\",\n                        //         \"notification\":\n                        //         {\n                        //             \"title\": \"payload.title\",\n                        //             \"body\": \"payload.body\",\n                        //             \"icon\": \"payload.icon\",\n                        //             \"click_action\": \"payload.action\"\n                        //         },\n                        //         \"data\":\n                        //         {\n                        //             \"shown\": false\n                        //         }\n                        // };\n                        // FirebaseService.sendNotificationToSelf(payload)\n\n                    });\n                })\n                .catch(err =>\n                {\n                    console.log(\"Unable to get permission to notify.\", err);\n                });\n        },\n        firebaseNotificationsHandler()\n        {\n            const THIS = this;\n            this._firebaseInit();\n            // this._firebaseRequestPermission();\n\n            // -----------------------------------------------------------------------------------------------------\n            // Event listeners\n\n            THIS.firebase.messaging.onTokenRefresh(() =>\n            {\n                this._firebaseGetToken();\n                console.log(\"TOKEN REFRESHED: \", THIS.firebase.token);\n            });\n\n            THIS.firebase.messaging.onMessage(payload =>\n            {\n                console.log(\"Message received. \", payload);\n                if (Notification.permission === \"granted\")\n                {\n                    const notification = new Notification(payload.notification.title,\n                    {\n                        icon: payload.notification.icon,\n                        body: payload.notification.body\n                    });\n                    notification.onclick = function ()\n                    {\n                        console.log(\"NOTIFCATION CLICK\");\n                        window.open(payload.notification.click_action, \"_blank\");\n                    };\n                    return notification;\n                }\n            });\n        },\n    }\n}\n</script>\n"],"sourceRoot":"src/views"}]}