{"remainingRequest":"/Users/ale/Documents/Bachproef/pwa-3/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/ale/Documents/Bachproef/pwa-3/src/views/Update.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/ale/Documents/Bachproef/pwa-3/src/views/Update.vue","mtime":1556781541389},{"path":"/Users/ale/Documents/Bachproef/pwa-3/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/ale/Documents/Bachproef/pwa-3/node_modules/vuetify-loader/lib/loader.js","mtime":1549812933000},{"path":"/Users/ale/Documents/Bachproef/pwa-3/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/ale/Documents/Bachproef/pwa-3/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\n\timport  {FirebaseService} from \"../services/FirebaseService\";\n\timport * as localForage from \"localforage\";\n\texport default {\n\t\tname: \"Update\",\n\t\tdata()\n\t\t{\n\t\t\treturn {\n\t\t\t\tservice_worker: null,\n\t\t\t\tnewWorker: null,\n\t\t\t\tpageTitle: \"Update\",\n\t\t\t\tswName: \"sw.js\",\n\t\t\t\tlf: null,\n\t\t\t\tfirebaseToken: null,\n                update: false,\n\t\t\t}\n\t\t},\n\t\tcomputed: {},\n\t\tcreated()\n\t\t{\n\t\t\tconsole.log(\"Creating Update, \", window.location.pathname);\n\t\t\tthis.install_sw();\n\t\t\tthis.lf = localForage.createInstance({name: \"lf\"});\n\t\t\tthis.lf.getItem(\"token\")\n\t\t\t    .then((token) =>\n\t\t\t          {\n\t\t\t\t          this.firebaseToken = token;\n\t\t\t          })\n\t\t\t    .catch(error => console.error(\"Error retrieving token from localStorage\"));\n\t\t\tsetTimeout(\n\t\t\t() =>\n\t\t\t{\n\t\t\t\tlet img = document.createElement(\"img\");\n\t\t\t\timg.src = \"/img/horse.jpg\";\n\t\t\t\timg.style = \"max-width: 100%; max-height: 500px;\";\n\t\t\t\tif (document.getElementById('imgElement'))\n\t\t\t\t{\n\t\t\t\t\tdocument.getElementById('imgElement')\n\t\t\t\t\t        .appendChild(img);\n\t\t\t\t}\n\t\t\t}, 3000);\n\t\t},\n\t\tmethods:\n\t\t{\n\t\t\tinstall_sw()\n\t\t\t{\n\t\t\t\tconst pathName = window.location.pathname;\n\t\t\t\tconsole.log(pathName);\n\t\t\t\tif (pathName === '/')\n\t\t\t\t\treturn;\n\n\t\t\t\tif (pathName === '/update-without-skip-and-claim')\n\t\t\t\t{\n\t\t\t\t\tthis.pageTitle = \"Update without skip and claim\";\n\t\t\t\t\tthis.swName = '/sw-without-skip-and-claim.js';\n\t\t\t\t} else if (pathName === '/update-with-skip-no-claim')\n\t\t\t\t{\n\t\t\t\t\tthis.pageTitle = \"Update with skip, not claim\";\n\t\t\t\t\tthis.swName = '/sw-with-skip-no-claim.js';\n\t\t\t\t} else if (pathName === '/update-with-skip-and-claim')\n\t\t\t\t{\n\t\t\t\t\tthis.pageTitle = \"Update with skip and claim\";\n\t\t\t\t\tthis.swName = '/sw-with-skip-and-claim.js';\n\t\t\t\t}\n\n\t\t\t\twindow.addEventListener(\n\t\t\t\t'load',\n\t\t\t\tasync () =>\n\t\t\t\t{\n\t\t\t\t\tnavigator\n\t\t\t\t\t.serviceWorker\n\t\t\t\t\t.register(this.swName, {scope: pathName})\n\t\t\t\t\t.then((registration) =>\n\t\t\t\t\t      {\n\t\t\t\t\t\t      this.registration = registration;\n\t\t\t\t\t\t      this._updateListener();\n\t\t\t\t\t\t      console.log('SW UPDATE_DEMO OK: ', registration.scope);\n\t\t\t\t\t      },\n\t\t\t\t\t      (err) => { console.log('SW UPDATE_DEMO FAILED: ', err); })\n\t\t\t\t\t.then(() =>\n\t\t\t\t\t      {\n\t\t\t\t\t\t      console.log('SW READY', pathName);\n\t\t\t\t\t\t      this.service_worker = navigator.serviceWorker;\n\t\t\t\t\t\t      return navigator.serviceWorker.ready;\n\t\t\t\t\t      });\n\n\t\t\t\t});\n\t\t\t},\n            _notifyUpdate()\n            {\n\t            // let payload = {\n\t\t        //     \"to\": this.firebaseToken,\n\t\t        //     \"collapse_key\": \"type_a\",\n\t\t        //     \"notification\":\n\t\t        //     {\n\t\t\t    //         \"title\": \"Update available\",\n\t\t\t    //         \"body\": \"Update available\",\n\t\t\t    //         \"icon\": \"/images/icons/icon-72x72.png\",\n\t\t\t    //         \"click_action\": \"/\"\n\t\t        //     },\n\t\t        //     \"data\":\n\t\t        //     {\n\t\t\t    //         \"shown\": false\n\t\t        //     }\n\t            // };\n\t            // FirebaseService.sendNotificationToSelf(payload)\n\t            // this.lf.getItem(\"token\")\n\t            //     .then((token) =>\n\t            //           {\n\t\t        //\n\t            //           })\n\t            //     .catch(error => console.error(\"Error retrieving token from localStorage\"));\n            }\n            ,\n\t\t\t_updateListener()\n\t\t\t{\n\t\t\t\tif (this.registration.waiting && this.registration.active)\n\t\t\t\t{\n\t\t\t\t\tthis.newWorker = this.registration.waiting;\n\t\t\t\t\tconsole.log(\"SW DETECTING UPDATE 1\");\n                    // this._notifyUpdate();\n                    this.update = true;\n\t\t\t\t} else\n\t\t\t\t{\n\t\t\t\t\tthis.registration.addEventListener(\n\t\t\t\t\t'updatefound',\n\t\t\t\t\t() =>\n\t\t\t\t\t{\n\n\t\t\t\t\t\tthis.newWorker = this.registration.installing;\n\n\t\t\t\t\t\tthis.newWorker\n\t\t\t\t\t\t    .addEventListener(\n\t\t\t\t\t\t    'statechange',\n\t\t\t\t\t\t    () =>\n\t\t\t\t\t\t    {\n\t\t\t\t\t\t\t    // Has service worker state changed?\n\t\t\t\t\t\t\t    switch (this.newWorker.state)\n\t\t\t\t\t\t\t    {\n\t\t\t\t\t\t\t\t    case 'installed':\n\n\t\t\t\t\t\t\t\t\t    // There is a new service worker available, show the\n\t\t\t\t\t\t\t\t\t    // notification\n\t\t\t\t\t\t\t\t\t    if (navigator.serviceWorker.controller)\n\t\t\t\t\t\t\t\t\t    {\n\t\t\t\t\t\t\t\t\t\t    console.log(\"SW DETECTING UPDATE 2\");\n\t\t\t\t\t\t\t\t\t\t    // this._notifyUpdate();\n\t\t\t\t\t\t\t\t\t\t    this.update = true;\n\t\t\t\t\t\t\t\t\t    }\n\t\t\t\t\t\t\t\t\t    break;\n\t\t\t\t\t\t\t    }\n\t\t\t\t\t\t    });\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\t\t\tunregister_sw()\n\t\t\t{\n\t\t\t\tthis.registration.unregister()\n\t\t\t\t    .then(() =>\n\t\t\t\t          {\n\t\t\t\t\t          console.log(\"Unregister\");\n\t\t\t\t          });\n\t\t\t},\n\t\t\trequest_from_sw()\n\t\t\t{\n\t\t\t\tlet request = new Request(`/${this.swName}`);\n\t\t\t\tconst requestOptions = {method: 'GET'};\n\t\t\t\treturn fetch(request, requestOptions)\n\t\t\t\t.then((response) =>\n\t\t\t\t      {\n\t\t\t\t\t      return {\n\t\t\t\t\t\t      request: request,\n\t\t\t\t\t\t      response: response\n\t\t\t\t\t      };\n\t\t\t\t      })\n\t\t\t\t.catch(error =>\n\t\t\t\t       {\n\t\t\t\t\t       console.error(error);\n\t\t\t\t\t       console.error(JSON.stringify(error));\n\t\t\t\t\t       return {\n\t\t\t\t\t\t       request: request,\n\t\t\t\t\t\t       response: response\n\t\t\t\t\t       };\n\t\t\t\t       });\n\t\t\t},\n\t\t\tsend_new_sw()\n\t\t\t{\n\t\t\t\tthis.$emit('updateRequest');\n\t\t\t\t// this.newWorker.postMessage({action: 'skipWaiting'});\n\t\t\t},\n\t\t}\n\t}\n",{"version":3,"sources":["Update.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;AAsBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Update.vue","sourceRoot":"src/views","sourcesContent":["<template>\n    <div>\n        <h1>{{ pageTitle }}</h1>\n        <h2>Update available: {{update}}</h2>\n        <a style=\"\"\n           v-on:click=\"request_from_sw()\">REQUEST\n        </a>\n        <br>\n        <a style=\"\"\n           v-on:click=\"unregister_sw()\">UNREGISTER\n        </a>\n        <div style=\"display:block;\">\n\n            <img src=\"/img/horse.jpg\"\n                 style=\"display:inline-block; max-height: 500px; max-width: 50%;\">\n            <div id=\"imgElement\"\n                 style=\"display:inline-block; max-height: 500px; max-width: 50%;\"></div>\n        </div>\n    </div>\n</template>\n\n<script>\n\timport  {FirebaseService} from \"../services/FirebaseService\";\n\timport * as localForage from \"localforage\";\n\texport default {\n\t\tname: \"Update\",\n\t\tdata()\n\t\t{\n\t\t\treturn {\n\t\t\t\tservice_worker: null,\n\t\t\t\tnewWorker: null,\n\t\t\t\tpageTitle: \"Update\",\n\t\t\t\tswName: \"sw.js\",\n\t\t\t\tlf: null,\n\t\t\t\tfirebaseToken: null,\n                update: false,\n\t\t\t}\n\t\t},\n\t\tcomputed: {},\n\t\tcreated()\n\t\t{\n\t\t\tconsole.log(\"Creating Update, \", window.location.pathname);\n\t\t\tthis.install_sw();\n\t\t\tthis.lf = localForage.createInstance({name: \"lf\"});\n\t\t\tthis.lf.getItem(\"token\")\n\t\t\t    .then((token) =>\n\t\t\t          {\n\t\t\t\t          this.firebaseToken = token;\n\t\t\t          })\n\t\t\t    .catch(error => console.error(\"Error retrieving token from localStorage\"));\n\t\t\tsetTimeout(\n\t\t\t() =>\n\t\t\t{\n\t\t\t\tlet img = document.createElement(\"img\");\n\t\t\t\timg.src = \"/img/horse.jpg\";\n\t\t\t\timg.style = \"max-width: 100%; max-height: 500px;\";\n\t\t\t\tif (document.getElementById('imgElement'))\n\t\t\t\t{\n\t\t\t\t\tdocument.getElementById('imgElement')\n\t\t\t\t\t        .appendChild(img);\n\t\t\t\t}\n\t\t\t}, 3000);\n\t\t},\n\t\tmethods:\n\t\t{\n\t\t\tinstall_sw()\n\t\t\t{\n\t\t\t\tconst pathName = window.location.pathname;\n\t\t\t\tconsole.log(pathName);\n\t\t\t\tif (pathName === '/')\n\t\t\t\t\treturn;\n\n\t\t\t\tif (pathName === '/update-without-skip-and-claim')\n\t\t\t\t{\n\t\t\t\t\tthis.pageTitle = \"Update without skip and claim\";\n\t\t\t\t\tthis.swName = '/sw-without-skip-and-claim.js';\n\t\t\t\t} else if (pathName === '/update-with-skip-no-claim')\n\t\t\t\t{\n\t\t\t\t\tthis.pageTitle = \"Update with skip, not claim\";\n\t\t\t\t\tthis.swName = '/sw-with-skip-no-claim.js';\n\t\t\t\t} else if (pathName === '/update-with-skip-and-claim')\n\t\t\t\t{\n\t\t\t\t\tthis.pageTitle = \"Update with skip and claim\";\n\t\t\t\t\tthis.swName = '/sw-with-skip-and-claim.js';\n\t\t\t\t}\n\n\t\t\t\twindow.addEventListener(\n\t\t\t\t'load',\n\t\t\t\tasync () =>\n\t\t\t\t{\n\t\t\t\t\tnavigator\n\t\t\t\t\t.serviceWorker\n\t\t\t\t\t.register(this.swName, {scope: pathName})\n\t\t\t\t\t.then((registration) =>\n\t\t\t\t\t      {\n\t\t\t\t\t\t      this.registration = registration;\n\t\t\t\t\t\t      this._updateListener();\n\t\t\t\t\t\t      console.log('SW UPDATE_DEMO OK: ', registration.scope);\n\t\t\t\t\t      },\n\t\t\t\t\t      (err) => { console.log('SW UPDATE_DEMO FAILED: ', err); })\n\t\t\t\t\t.then(() =>\n\t\t\t\t\t      {\n\t\t\t\t\t\t      console.log('SW READY', pathName);\n\t\t\t\t\t\t      this.service_worker = navigator.serviceWorker;\n\t\t\t\t\t\t      return navigator.serviceWorker.ready;\n\t\t\t\t\t      });\n\n\t\t\t\t});\n\t\t\t},\n            _notifyUpdate()\n            {\n\t            // let payload = {\n\t\t        //     \"to\": this.firebaseToken,\n\t\t        //     \"collapse_key\": \"type_a\",\n\t\t        //     \"notification\":\n\t\t        //     {\n\t\t\t    //         \"title\": \"Update available\",\n\t\t\t    //         \"body\": \"Update available\",\n\t\t\t    //         \"icon\": \"/images/icons/icon-72x72.png\",\n\t\t\t    //         \"click_action\": \"/\"\n\t\t        //     },\n\t\t        //     \"data\":\n\t\t        //     {\n\t\t\t    //         \"shown\": false\n\t\t        //     }\n\t            // };\n\t            // FirebaseService.sendNotificationToSelf(payload)\n\t            // this.lf.getItem(\"token\")\n\t            //     .then((token) =>\n\t            //           {\n\t\t        //\n\t            //           })\n\t            //     .catch(error => console.error(\"Error retrieving token from localStorage\"));\n            }\n            ,\n\t\t\t_updateListener()\n\t\t\t{\n\t\t\t\tif (this.registration.waiting && this.registration.active)\n\t\t\t\t{\n\t\t\t\t\tthis.newWorker = this.registration.waiting;\n\t\t\t\t\tconsole.log(\"SW DETECTING UPDATE 1\");\n                    // this._notifyUpdate();\n                    this.update = true;\n\t\t\t\t} else\n\t\t\t\t{\n\t\t\t\t\tthis.registration.addEventListener(\n\t\t\t\t\t'updatefound',\n\t\t\t\t\t() =>\n\t\t\t\t\t{\n\n\t\t\t\t\t\tthis.newWorker = this.registration.installing;\n\n\t\t\t\t\t\tthis.newWorker\n\t\t\t\t\t\t    .addEventListener(\n\t\t\t\t\t\t    'statechange',\n\t\t\t\t\t\t    () =>\n\t\t\t\t\t\t    {\n\t\t\t\t\t\t\t    // Has service worker state changed?\n\t\t\t\t\t\t\t    switch (this.newWorker.state)\n\t\t\t\t\t\t\t    {\n\t\t\t\t\t\t\t\t    case 'installed':\n\n\t\t\t\t\t\t\t\t\t    // There is a new service worker available, show the\n\t\t\t\t\t\t\t\t\t    // notification\n\t\t\t\t\t\t\t\t\t    if (navigator.serviceWorker.controller)\n\t\t\t\t\t\t\t\t\t    {\n\t\t\t\t\t\t\t\t\t\t    console.log(\"SW DETECTING UPDATE 2\");\n\t\t\t\t\t\t\t\t\t\t    // this._notifyUpdate();\n\t\t\t\t\t\t\t\t\t\t    this.update = true;\n\t\t\t\t\t\t\t\t\t    }\n\t\t\t\t\t\t\t\t\t    break;\n\t\t\t\t\t\t\t    }\n\t\t\t\t\t\t    });\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\t\t\tunregister_sw()\n\t\t\t{\n\t\t\t\tthis.registration.unregister()\n\t\t\t\t    .then(() =>\n\t\t\t\t          {\n\t\t\t\t\t          console.log(\"Unregister\");\n\t\t\t\t          });\n\t\t\t},\n\t\t\trequest_from_sw()\n\t\t\t{\n\t\t\t\tlet request = new Request(`/${this.swName}`);\n\t\t\t\tconst requestOptions = {method: 'GET'};\n\t\t\t\treturn fetch(request, requestOptions)\n\t\t\t\t.then((response) =>\n\t\t\t\t      {\n\t\t\t\t\t      return {\n\t\t\t\t\t\t      request: request,\n\t\t\t\t\t\t      response: response\n\t\t\t\t\t      };\n\t\t\t\t      })\n\t\t\t\t.catch(error =>\n\t\t\t\t       {\n\t\t\t\t\t       console.error(error);\n\t\t\t\t\t       console.error(JSON.stringify(error));\n\t\t\t\t\t       return {\n\t\t\t\t\t\t       request: request,\n\t\t\t\t\t\t       response: response\n\t\t\t\t\t       };\n\t\t\t\t       });\n\t\t\t},\n\t\t\tsend_new_sw()\n\t\t\t{\n\t\t\t\tthis.$emit('updateRequest');\n\t\t\t\t// this.newWorker.postMessage({action: 'skipWaiting'});\n\t\t\t},\n\t\t}\n\t}\n</script>\n\n<style scoped>\n\n</style>\n"]}]}